<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: PESTFix</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">PESTFix</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/fix_rb.html">
                fix.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000021">answerButtonCheck</a>&nbsp;&nbsp;
      <a href="#M000022">answerChanged</a>&nbsp;&nbsp;
      <a href="#M000023">answerNext</a>&nbsp;&nbsp;
      <a href="#M000024">answerPrev</a>&nbsp;&nbsp;
      <a href="#M000013">exportAsSql</a>&nbsp;&nbsp;
      <a href="#M000008">fileAlreadyParsed?</a>&nbsp;&nbsp;
      <a href="#M000026">findPageForQuestion</a>&nbsp;&nbsp;
      <a href="#M000033">imageButtonCheck</a>&nbsp;&nbsp;
      <a href="#M000039">imageDraw</a>&nbsp;&nbsp;
      <a href="#M000034">imagePrevNext</a>&nbsp;&nbsp;
      <a href="#M000038">imageUpdate</a>&nbsp;&nbsp;
      <a href="#M000012">initAccelerators</a>&nbsp;&nbsp;
      <a href="#M000007">initGetWorkingDirectory</a>&nbsp;&nbsp;
      <a href="#M000014">initGui</a>&nbsp;&nbsp;
      <a href="#M000011">initToolbar</a>&nbsp;&nbsp;
      <a href="#M000015">jumpTo</a>&nbsp;&nbsp;
      <a href="#M000006">new</a>&nbsp;&nbsp;
      <a href="#M000009">parseDirectory</a>&nbsp;&nbsp;
      <a href="#M000030">processEvents</a>&nbsp;&nbsp;
      <a href="#M000031">pulse</a>&nbsp;&nbsp;
      <a href="#M000020">questionButtonCheck</a>&nbsp;&nbsp;
      <a href="#M000028">questionFindFail</a>&nbsp;&nbsp;
      <a href="#M000029">questionFindFailPreload</a>&nbsp;&nbsp;
      <a href="#M000027">questionFirst</a>&nbsp;&nbsp;
      <a href="#M000025">questionPrevNext</a>&nbsp;&nbsp;
      <a href="#M000040">quitApp</a>&nbsp;&nbsp;
      <a href="#M000036">sheetLoad</a>&nbsp;&nbsp;
      <a href="#M000037">sheetPreload</a>&nbsp;&nbsp;
      <a href="#M000032">stopFindFail</a>&nbsp;&nbsp;
      <a href="#M000010">titleUpdate</a>&nbsp;&nbsp;
      <a href="#M000016">undo</a>&nbsp;&nbsp;
      <a href="#M000018">undoCommit</a>&nbsp;&nbsp;
      <a href="#M000019">undoEnd</a>&nbsp;&nbsp;
      <a href="#M000017">undoStart</a>&nbsp;&nbsp;
      <a href="#M000035">writeYAML</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(win)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
    <span class="ruby-comment cmt"># File fix.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">win</span>)
34:         <span class="ruby-identifier">puts</span> <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Magick_version</span>
35: 
36:         <span class="ruby-comment cmt"># global Variables</span>
37:         <span class="ruby-ivar">@window</span> = <span class="ruby-identifier">win</span>
38:         <span class="ruby-ivar">@gdkrgb</span> = <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Pixbuf</span><span class="ruby-operator">::</span><span class="ruby-constant">ColorSpace</span><span class="ruby-operator">::</span><span class="ruby-constant">RGB</span>
39:         <span class="ruby-ivar">@undoActions</span> = []
40:         <span class="ruby-ivar">@files</span> = []
41:         <span class="ruby-ivar">@dir</span> = <span class="ruby-identifier">initGetWorkingDirectory</span>
42:         <span class="ruby-ivar">@imgpath</span> = <span class="ruby-value str">&quot;&quot;</span>
43:         <span class="ruby-ivar">@preloadMePlease</span> = <span class="ruby-keyword kw">nil</span>
44:         <span class="ruby-ivar">@noChoiceDrawWidth</span> = <span class="ruby-value">40</span>
45:         <span class="ruby-comment cmt"># Call writeYAML if you change this!</span>
46:         <span class="ruby-ivar">@currentImage</span> = <span class="ruby-value">-1</span>
47:         <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">false</span>
48:         
49:         <span class="ruby-identifier">parseDirectory</span>
50:         <span class="ruby-identifier">initGui</span>
51: 
52:         <span class="ruby-comment cmt"># Disabled for now as it confusingly hangs the app</span>
53:         <span class="ruby-comment cmt">#@gtkParseDirThread = Gtk.timeout_add(30*1000) do</span>
54:         <span class="ruby-comment cmt">#    Gtk.idle_add do</span>
55:         <span class="ruby-comment cmt">#        parseDirectory</span>
56:         <span class="ruby-comment cmt">#        false</span>
57:         <span class="ruby-comment cmt">#    end</span>
58:         <span class="ruby-comment cmt">#    true</span>
59:         <span class="ruby-comment cmt">#end</span>
60: 
61:         <span class="ruby-comment cmt"># Remove these more or less uninteresting &quot;value set to&quot;</span>
62:         <span class="ruby-comment cmt"># messages after 5 seconds or so</span>
63:         <span class="ruby-ivar">@gtkParseDirThread</span> = <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">timeout_add</span>(<span class="ruby-value">5</span><span class="ruby-operator">*</span><span class="ruby-value">1000</span>) <span class="ruby-keyword kw">do</span>
64:             <span class="ruby-value">10</span>.<span class="ruby-identifier">times</span> { <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">pop</span> <span class="ruby-value">1</span> }
65:             <span class="ruby-identifier">processEvents</span>
66:             <span class="ruby-keyword kw">true</span>
67:         <span class="ruby-keyword kw">end</span>
68:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">answerButtonCheck</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks if the answer buttons need to be en/disabled and does so
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 487</span>
487:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answerButtonCheck</span>
488:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@doc</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@currentQuestion</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@group</span>
489:             <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
490:             <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
491:             <span class="ruby-keyword kw">return</span>
492:         <span class="ruby-keyword kw">end</span>
493: 
494:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'failchoice'</span>]
495:             <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">true</span>)
496:             <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">true</span>)
497:             <span class="ruby-keyword kw">return</span>
498:         <span class="ruby-keyword kw">end</span>
499:         
500:         <span class="ruby-identifier">nochoice</span> = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'nochoice'</span>]
501:                 <span class="ruby-comment cmt">#|| @group['value'] ==     @group['failchoice']</span>
502:         
503:         <span class="ruby-comment cmt"># Find currently selected answer</span>
504:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">nochoice</span>
505:             <span class="ruby-identifier">cur</span> = <span class="ruby-keyword kw">nil</span>
506:             <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
507:                 <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>]
508:                 <span class="ruby-comment cmt"># We've found the currently selected answer</span>
509:                 <span class="ruby-identifier">cur</span> = <span class="ruby-identifier">b</span>
510:                 <span class="ruby-keyword kw">break</span>
511:             <span class="ruby-keyword kw">end</span>
512:         <span class="ruby-keyword kw">end</span>
513:         
514:         <span class="ruby-identifier">p</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">nochoice</span>
515:         <span class="ruby-identifier">n</span> = <span class="ruby-identifier">nochoice</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">cur</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>].<span class="ruby-identifier">next</span>(<span class="ruby-identifier">cur</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>)
516:     
517:         <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-identifier">p</span>)
518:         <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-identifier">n</span>)
519:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">answerChanged</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Does the various update operations after an answer has changed
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 522</span>
522:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answerChanged</span>
523:         <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">true</span>
524:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;Setting value to &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>].<span class="ruby-identifier">to_s</span>
525:         <span class="ruby-identifier">imageUpdate</span>
526:         <span class="ruby-identifier">answerButtonCheck</span>
527:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">answerNext</span><span class="method-args">(amount = 1)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Selects the (current + amount)th answer and updates the image. If already
at the last answer, nothing will happen
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 531</span>
531:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answerNext</span>(<span class="ruby-identifier">amount</span> = <span class="ruby-value">1</span>)
532:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">sensitive?</span>
533:         <span class="ruby-identifier">undoCommit</span>
534:         <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">false</span>
535:         <span class="ruby-comment cmt"># If the current answer is either failed or nochoice, we need to select</span>
536:         <span class="ruby-comment cmt"># the first real answer</span>
537:         <span class="ruby-identifier">isBadAnsw</span> = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'nochoice'</span>] \
538:                 <span class="ruby-operator">||</span> (<span class="ruby-ivar">@group</span>[<span class="ruby-value str">'failchoice'</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'failchoice'</span>])
539:         <span class="ruby-identifier">amount</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isBadAnsw</span>
540:         <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
541:             <span class="ruby-comment cmt"># If the boxes don't have a choice attribute, it's probably</span>
542:             <span class="ruby-comment cmt"># a question that doesn't have different answers (i.e. a</span>
543:             <span class="ruby-comment cmt"># comment field that's non rectangular). If so, choose the</span>
544:             <span class="ruby-comment cmt"># choice attribute of the group and stop searching</span>
545:             <span class="ruby-comment cmt"># Choice because we want to select the next answer</span>
546:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>]
547:                 <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'choice'</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>
548:                 <span class="ruby-identifier">answerChanged</span>
549:                 <span class="ruby-keyword kw">break</span>
550:             <span class="ruby-keyword kw">end</span>
551:             
552:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">found</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">isBadAnsw</span>
553:             <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">true</span>
554:             <span class="ruby-identifier">amount</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
555:             <span class="ruby-comment cmt"># Instead of selecting nothing when the &quot;amount&quot; to go is larger</span>
556:             <span class="ruby-comment cmt"># than the available answers, select the last one</span>
557:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">amount</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>].<span class="ruby-identifier">next</span>(<span class="ruby-identifier">b</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
558:             <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>]
559:             <span class="ruby-identifier">answerChanged</span>
560:             <span class="ruby-keyword kw">return</span>
561:         <span class="ruby-keyword kw">end</span>
562:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">answerPrev</span><span class="method-args">(amount = 1)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Selects the (current - amount)th answer and updates the image. If already
at the first answer, it will switch to &quot;noChoice&quot; when available.
Otherwise, nothing will happen.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 567</span>
567:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answerPrev</span>(<span class="ruby-identifier">amount</span> = <span class="ruby-value">1</span>)
568:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">sensitive?</span>
569:         <span class="ruby-identifier">undoCommit</span>
570:         <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">false</span>
571:         
572:         <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>].<span class="ruby-identifier">reverse_each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
573:             <span class="ruby-comment cmt">#puts &quot;Group1: &quot;+b['choice'].to_s</span>
574:             <span class="ruby-comment cmt"># If the boxes don't have a choice attribute, it's probably</span>
575:             <span class="ruby-comment cmt"># a question that doesn't have different answers (i.e. a</span>
576:             <span class="ruby-comment cmt"># comment field that's non rectangular). If so, choose the</span>
577:             <span class="ruby-comment cmt"># nochoice attribute of the group and stop searching.</span>
578:             <span class="ruby-comment cmt"># Nochoice because we want to select the previous answer</span>
579:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>]                
580:                 <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'nochoice'</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
581:                 <span class="ruby-keyword kw">break</span>
582:             <span class="ruby-keyword kw">end</span>
583:             
584:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">found</span>
585:             <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">true</span>
586:             <span class="ruby-identifier">amount</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
587:             <span class="ruby-comment cmt"># Unlike answerNext, we don't check if the previous element</span>
588:             <span class="ruby-comment cmt"># is nil because we want to exit the loop with no action so</span>
589:             <span class="ruby-comment cmt"># we can easily select the &quot;no choice&quot; option</span>
590:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">amount</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
591:             <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>]
592:             <span class="ruby-identifier">answerChanged</span>
593:             <span class="ruby-keyword kw">return</span>
594:         <span class="ruby-keyword kw">end</span>
595: 
596:         <span class="ruby-comment cmt"># We're already at the first, so select &quot;nochoice&quot;</span>
597:         <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'nochoice'</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
598:         <span class="ruby-identifier">answerChanged</span>
599:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">exportAsSql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Exports current data set as SQL Doesn&#8216;t force the user to solve all
failed answers, but does a lookup so the user may notice there&#8216;s
something not quite right.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 316</span>
316:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exportAsSql</span>
317:         <span class="ruby-identifier">questionFindFail</span>
318: 
319:         <span class="ruby-identifier">dialog</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">FileChooserDialog</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Select Output SQL File&quot;</span>,
320:                  <span class="ruby-keyword kw">nil</span>,
321:                  <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">FileChooser</span><span class="ruby-operator">::</span><span class="ruby-constant">ACTION_SAVE</span>,
322:                  <span class="ruby-keyword kw">nil</span>,
323:                  [<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">CANCEL</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Dialog</span><span class="ruby-operator">::</span><span class="ruby-constant">RESPONSE_CANCEL</span>],
324:                  [<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">OPEN</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Dialog</span><span class="ruby-operator">::</span><span class="ruby-constant">RESPONSE_ACCEPT</span>])
325:         <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">set_window_position</span> <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Window</span><span class="ruby-operator">::</span><span class="ruby-constant">POS_CENTER</span>
326:         <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">set_do_overwrite_confirmation</span> <span class="ruby-keyword kw">true</span>
327:         <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">set_filename</span> <span class="ruby-value str">&quot;output.sql&quot;</span>
328: 
329:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">run</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Dialog</span><span class="ruby-operator">::</span><span class="ruby-constant">RESPONSE_ACCEPT</span>
330:             <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">destroy</span>
331:             <span class="ruby-keyword kw">return</span>
332:         <span class="ruby-keyword kw">end</span>
333:         <span class="ruby-identifier">f</span> = <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">filename</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(?=\s)/</span>, <span class="ruby-value str">&quot;\\&quot;</span>)
334:         <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">destroy</span>
335:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">6</span>, <span class="ruby-value str">&quot;Saving to &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; (have a look at the console if you want feedback. Otherwise just wait a bit)&quot;</span>
336: 
337:         <span class="ruby-identifier">system</span>(<span class="ruby-value str">&quot;ruby yaml2sql.rb &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@dir</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(?=\s)/</span>, <span class="ruby-value str">&quot;\\&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; overwrite &amp;&quot;</span>)
338:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">fileAlreadyParsed?</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Looks if the given file is already listed in @files
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 110</span>
110:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fileAlreadyParsed?</span>(<span class="ruby-identifier">file</span>)
111:         <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">assoc</span>(<span class="ruby-identifier">file</span>)
112:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">findPageForQuestion</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds the page for the current question
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 632</span>
632:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">findPageForQuestion</span>
633:         <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>].<span class="ruby-identifier">each_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@currentPage</span> = <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>][<span class="ruby-identifier">i</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@group</span>) }
634:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <a href="#M000033" class="method-signature">
          <span class="method-name">imageButtonCheck</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks if the image buttons need to be en/disabled and does so
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000033-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000033-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 743</span>
743:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">imageButtonCheck</span>
744:         <span class="ruby-ivar">@img_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
745:         <span class="ruby-ivar">@img_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">&lt;</span> (<span class="ruby-ivar">@files</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>))
746:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000039" class="method-detail">
        <a name="M000039"></a>

        <div class="method-heading">
          <a href="#M000039" class="method-signature">
          <span class="method-name">imageDraw</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Draws the image stored in @pixbuf to the screen. Resizes the image if
required while maintaining the aspect ratio. Called everytime the draw area
was partially hidden (e.g. by tooltips) or when the actual image changed
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000039-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000039-source">
<pre>
      <span class="ruby-comment cmt"># File fix.rb, line 990</span>
 990:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">imageDraw</span>
 991:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@pixbuf</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
 992:         
 993:         <span class="ruby-comment cmt">#start_time = Time.now</span>
 994:         <span class="ruby-identifier">gc</span> = <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">style</span>.<span class="ruby-identifier">fg_gc</span>(<span class="ruby-ivar">@area</span>.<span class="ruby-identifier">state</span>)
 995: 
 996:         <span class="ruby-identifier">maxw</span> = <span class="ruby-constant">Float</span>.<span class="ruby-identifier">induced_from</span>(<span class="ruby-ivar">@area</span>.<span class="ruby-identifier">window</span>.<span class="ruby-identifier">size</span>[<span class="ruby-value">0</span>])
 997:         <span class="ruby-identifier">maxh</span> = <span class="ruby-constant">Float</span>.<span class="ruby-identifier">induced_from</span>(<span class="ruby-ivar">@area</span>.<span class="ruby-identifier">window</span>.<span class="ruby-identifier">size</span>[<span class="ruby-value">1</span>])
 998: 
 999:         <span class="ruby-identifier">imgw</span> = <span class="ruby-ivar">@pixbuf</span>.<span class="ruby-identifier">width</span>
1000:         <span class="ruby-identifier">imgh</span> = <span class="ruby-ivar">@pixbuf</span>.<span class="ruby-identifier">height</span>
1001: 
1002:         <span class="ruby-comment cmt"># Return if the area is so small that its illegible  or if the</span>
1003:         <span class="ruby-comment cmt"># source image is broken somehow</span>
1004:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">maxw</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">50</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">maxh</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">50</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">imgw</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">imgh</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
1005: 
1006:         <span class="ruby-comment cmt"># Don't scale up</span>
1007:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">maxw</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">imgw</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">maxh</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">imgh</span>
1008:             <span class="ruby-comment cmt"># and keep the aspect ratio</span>
1009:             <span class="ruby-identifier">aspect</span> = <span class="ruby-identifier">imgh</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">imgw</span>.<span class="ruby-identifier">to_f</span>;
1010:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">aspect</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">maxh</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">maxw</span>
1011:                 <span class="ruby-identifier">imgw</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">min</span>(<span class="ruby-identifier">imgw</span>, <span class="ruby-identifier">maxw</span>);
1012:                 <span class="ruby-identifier">imgh</span> = (<span class="ruby-identifier">imgw</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">aspect</span>).<span class="ruby-identifier">round</span>;
1013:             <span class="ruby-keyword kw">else</span>
1014:                 <span class="ruby-identifier">imgh</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">min</span>(<span class="ruby-identifier">imgh</span>, <span class="ruby-identifier">maxh</span>);
1015:                 <span class="ruby-identifier">imgw</span> = (<span class="ruby-identifier">imgh</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">aspect</span>).<span class="ruby-identifier">round</span>;
1016:             <span class="ruby-keyword kw">end</span>
1017:         <span class="ruby-keyword kw">end</span>
1018:         <span class="ruby-ivar">@quickHelp</span>.<span class="ruby-identifier">set_size_request</span> <span class="ruby-identifier">maxw</span><span class="ruby-operator">-</span><span class="ruby-value">8</span>, <span class="ruby-value">-1</span>
1019:         <span class="ruby-ivar">@area</span>.<span class="ruby-identifier">window</span>.<span class="ruby-identifier">draw_pixbuf</span>(<span class="ruby-identifier">gc</span>, <span class="ruby-ivar">@pixbuf</span>.<span class="ruby-identifier">scale</span>(<span class="ruby-identifier">imgw</span>, <span class="ruby-identifier">imgh</span>), <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">imgw</span>, <span class="ruby-identifier">imgh</span>, <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">RGB</span><span class="ruby-operator">::</span><span class="ruby-constant">DITHER_NORMAL</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>)
1020:         <span class="ruby-comment cmt">#puts &quot;Drawing image to screen (took: &quot; + (Time.now-start_time).to_s + &quot; s)&quot;</span>
1021:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">imagePrevNext</span><span class="method-args">(isPrev)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Small helper function that enables the prev/next buttons depending on the
current position, updates the window title and loads the <a
href="PESTFix.html#M000006">new</a> image from disk
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 751</span>
751:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">imagePrevNext</span>(<span class="ruby-identifier">isPrev</span>)
752:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@img_next</span>.<span class="ruby-identifier">sensitive?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">isPrev</span>
753:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@img_prev</span>.<span class="ruby-identifier">sensitive?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">isPrev</span>
754:         <span class="ruby-ivar">@starttime</span>= <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
755:         <span class="ruby-identifier">stopFindFail</span>
756:         <span class="ruby-identifier">writeYAML</span>
757:         <span class="ruby-identifier">oldImage</span> = <span class="ruby-ivar">@currentImage</span>
758:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isPrev</span>
759:             <span class="ruby-ivar">@currentImage</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
760:             <span class="ruby-ivar">@preloadMePlease</span> = <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
761:         <span class="ruby-keyword kw">else</span>
762:             <span class="ruby-ivar">@currentImage</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">&lt;</span> (<span class="ruby-ivar">@files</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)
763:             <span class="ruby-ivar">@preloadMePlease</span> = <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
764:         <span class="ruby-keyword kw">end</span>
765:         
766:         <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">idle_add</span> { <span class="ruby-identifier">sheetPreload</span> } 
767: 
768:         <span class="ruby-comment cmt"># Nothing changed, so we're already at the first/last image</span>
769:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">oldImage</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@currentImage</span>
770:         
771:         <span class="ruby-identifier">imageButtonCheck</span>
772: 
773:         <span class="ruby-ivar">@imgpath</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@files</span>[<span class="ruby-ivar">@currentImage</span>][<span class="ruby-value">0</span>] <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;&quot;</span>
774:         
775:         <span class="ruby-identifier">sheetLoad</span>
776:         <span class="ruby-identifier">questionFirst</span>
777:         <span class="ruby-identifier">imageUpdate</span>
778:         <span class="ruby-identifier">titleUpdate</span>
779:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000038" class="method-detail">
        <a name="M000038"></a>

        <div class="method-heading">
          <a href="#M000038" class="method-signature">
          <span class="method-name">imageUpdate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This does most of the work related to generating the image. It finds a
suitable cutout and draws the boxes over it. The result is saved to @pixbuf
and the DrawingArea gets invalidated so the changes show up (followup: <a
href="PESTFix.html#M000039">imageDraw</a>)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000038-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000038-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 888</span>
888:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">imageUpdate</span>
889:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@group</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@orig</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@currentPage</span>
890:         <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
891:         <span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;Updating on screen image&quot;</span>
892: 
893:         <span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">height</span> = <span class="ruby-identifier">calculateBounds</span>(<span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>], <span class="ruby-ivar">@group</span>, <span class="ruby-ivar">@noChoiceDrawWidth</span>)
894: 
895:         <span class="ruby-identifier">draw</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Draw</span>.<span class="ruby-identifier">new</span>
896: 
897:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">font_weight</span> = <span class="ruby-value">100</span>
898:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">pointsize</span> = <span class="ruby-value">20</span>           
899: 
900:         <span class="ruby-comment cmt"># Draws the &quot;no choice&quot; checkbox</span>
901:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-value str">&quot;white&quot;</span>)
902:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-value str">&quot;black&quot;</span>)
903:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-ivar">@noChoiceDrawWidth</span>, <span class="ruby-ivar">@noChoiceDrawWidth</span>)    
904:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'nochoice'</span>]
905:             <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-value str">&quot;green&quot;</span>)
906:             <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-value str">&quot;green&quot;</span>)
907:         <span class="ruby-keyword kw">else</span>
908:             <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-value str">&quot;red&quot;</span>)
909:             <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-value str">&quot;red&quot;</span>)
910:         <span class="ruby-keyword kw">end</span>
911:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill_opacity</span>(<span class="ruby-value">0</span><span class="ruby-value">.4</span>)
912:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-ivar">@noChoiceDrawWidth</span>, <span class="ruby-ivar">@noChoiceDrawWidth</span>)
913: 
914:         <span class="ruby-comment cmt"># Draw the colored boxes</span>
915:         <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'boxes'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
916:             <span class="ruby-identifier">w</span>, <span class="ruby-identifier">h</span> = <span class="ruby-identifier">getBoxDimension</span>(<span class="ruby-identifier">b</span>, <span class="ruby-ivar">@group</span>)
917:             <span class="ruby-comment cmt"># The former is for &quot;normal&quot; question where a different box</span>
918:             <span class="ruby-comment cmt"># means a different answer. The latter is for when the whole</span>
919:             <span class="ruby-comment cmt"># group can either be on or off but consists of several</span>
920:             <span class="ruby-comment cmt"># boxes. E.g. a comment field that's not rectangular</span>
921:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">b</span>[<span class="ruby-value str">'choice'</span>] <span class="ruby-operator">||</span> (<span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'choice'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'choice'</span>])
922:                 <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-value str">&quot;green&quot;</span>)
923:                 <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-value str">&quot;green&quot;</span>)
924:             <span class="ruby-keyword kw">else</span>
925:                 <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-value str">&quot;red&quot;</span>)
926:                 <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-value str">&quot;red&quot;</span>)
927:             <span class="ruby-keyword kw">end</span>
928:             <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">fill_opacity</span>(<span class="ruby-value">0</span><span class="ruby-value">.4</span>)
929: 
930:             <span class="ruby-identifier">bx</span> = <span class="ruby-identifier">b</span>[<span class="ruby-value str">'x'</span>]
931:             <span class="ruby-identifier">by</span> = <span class="ruby-identifier">b</span>[<span class="ruby-value str">'y'</span>]
932:             <span class="ruby-identifier">bw</span> = <span class="ruby-identifier">b</span>[<span class="ruby-value str">'width'</span>]
933:             <span class="ruby-identifier">bh</span> = <span class="ruby-identifier">b</span>[<span class="ruby-value str">'height'</span>]
934:             
935:             <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-identifier">bx</span><span class="ruby-operator">-</span><span class="ruby-identifier">x</span>, <span class="ruby-identifier">by</span><span class="ruby-operator">-</span><span class="ruby-identifier">y</span>, <span class="ruby-identifier">bx</span><span class="ruby-operator">-</span><span class="ruby-identifier">x</span><span class="ruby-operator">+</span><span class="ruby-identifier">w</span>, <span class="ruby-identifier">by</span><span class="ruby-operator">-</span><span class="ruby-identifier">y</span><span class="ruby-operator">+</span><span class="ruby-identifier">h</span>)
936:         <span class="ruby-keyword kw">end</span>
937: 
938:         <span class="ruby-identifier">imgid</span> = <span class="ruby-constant">Math</span><span class="ruby-operator">::</span><span class="ruby-identifier">min</span>(<span class="ruby-ivar">@orig</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>, <span class="ruby-ivar">@currentPage</span>)
939: 
940:         <span class="ruby-comment cmt"># Create a new copy that we can waste</span>
941:         <span class="ruby-identifier">img</span> = <span class="ruby-ivar">@orig</span>[<span class="ruby-identifier">imgid</span>].<span class="ruby-identifier">crop</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">height</span>)
942:         
943:         <span class="ruby-comment cmt"># Apply boxes</span>
944:         <span class="ruby-comment cmt">#threadDrawImage.join</span>
945:         <span class="ruby-identifier">draw</span>.<span class="ruby-identifier">draw</span>(<span class="ruby-identifier">img</span>)
946: 
947:         <span class="ruby-comment cmt"># Hack! Hack! Writing it to disk and reading it again is still</span>
948:         <span class="ruby-comment cmt"># faster than an in-memory way. Partly because Gdk's import</span>
949:         <span class="ruby-comment cmt"># functions suck and partly due to RMagick's to_blob being very</span>
950:         <span class="ruby-comment cmt"># slow</span>
951:         <span class="ruby-identifier">temp</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;image&quot;</span>)
952:         <span class="ruby-keyword kw">begin</span>
953:             <span class="ruby-comment cmt"># Writing TIFs is fastest, so obviously use TIF. Takes</span>
954:             <span class="ruby-comment cmt"># ~0.08s which is about three times faster</span>
955:             <span class="ruby-identifier">img</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;tif:&quot;</span><span class="ruby-operator">+</span> <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">path</span>)    
956:             <span class="ruby-ivar">@pixbuf</span> = <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Pixbuf</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">temp</span>.<span class="ruby-identifier">path</span>)
957:         <span class="ruby-keyword kw">rescue</span>
958:             <span class="ruby-comment cmt"># However some of these are broken for no apparent reason</span>
959:             <span class="ruby-comment cmt"># Work around this and save it as a JPG (was 2nd fastest)</span>
960:             <span class="ruby-comment cmt"># Put altogether it takes ~0.18s when this occurs and is</span>
961:             <span class="ruby-comment cmt"># as fast as an optimized in-memory path, so our loss isn't</span>
962:             <span class="ruby-comment cmt"># too bad</span>
963:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;BORKEN! BORKEN! ImageMagick/RMagick wrote a corrupted TIF again&quot;</span>
964:             <span class="ruby-identifier">img</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;jpg:&quot;</span><span class="ruby-operator">+</span> <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">path</span>)    
965:             <span class="ruby-ivar">@pixbuf</span> = <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Pixbuf</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">temp</span>.<span class="ruby-identifier">path</span>)
966:         <span class="ruby-keyword kw">end</span>
967:         
968:         <span class="ruby-comment cmt"># This was the old method. Without the thumbail stuff it took</span>
969:         <span class="ruby-comment cmt"># ~0.27s, reducing the size speeded it up to ~0.18s for each</span>
970:         <span class="ruby-comment cmt"># load. It's still too slow and it's a noticeable delay for the</span>
971:         <span class="ruby-comment cmt"># user</span>
972:         <span class="ruby-comment cmt">#img.thumbnail!(0.5)</span>
973:         <span class="ruby-comment cmt">#blob = img.to_blob{self.depth=8; self.format=&quot;RGB&quot;}</span>
974:         <span class="ruby-comment cmt">#@pixbuf = Gdk::Pixbuf.new(blob, @gdkrgb, false, 8, </span>
975:         <span class="ruby-comment cmt">#                          img.columns, img.rows, img.columns*3)</span>
976:         
977:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot; (took: &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span><span class="ruby-operator">-</span><span class="ruby-identifier">start_time</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; s)&quot;</span>
978: 
979:         <span class="ruby-comment cmt"># Invalidate area if possible. This may not be the case when the</span>
980:         <span class="ruby-comment cmt"># app starts up, but imageDraw will be called automatically any-</span>
981:         <span class="ruby-comment cmt"># way, so we don't need to bother at this point</span>
982:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@area</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@area</span>.<span class="ruby-identifier">window</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
983:         <span class="ruby-ivar">@area</span>.<span class="ruby-identifier">queue_draw_area</span>(<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-ivar">@area</span>.<span class="ruby-identifier">window</span>.<span class="ruby-identifier">size</span>[<span class="ruby-value">0</span>], <span class="ruby-ivar">@area</span>.<span class="ruby-identifier">window</span>.<span class="ruby-identifier">size</span>[<span class="ruby-value">1</span>])
984:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">initAccelerators</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up all keyboard shortcuts globally
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 251</span>
251:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initAccelerators</span>
252:         <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;key_press_event&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">widget</span>, <span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
253:             <span class="ruby-identifier">isCtrl</span> = <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Window</span><span class="ruby-operator">::</span><span class="ruby-constant">ModifierType</span><span class="ruby-operator">::</span><span class="ruby-constant">CONTROL_MASK</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">state</span>
254:             <span class="ruby-identifier">g</span> = <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyval</span>
255:             <span class="ruby-identifier">k</span> = <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyval</span>.<span class="ruby-identifier">to_lower</span>(<span class="ruby-identifier">event</span>.<span class="ruby-identifier">keyval</span>)
256: 
257:             <span class="ruby-comment cmt"># Nerd Shortcuts</span>
258:             <span class="ruby-comment cmt"># This is used to provide an alternative to the arrow keys for</span>
259:             <span class="ruby-comment cmt"># selecting an answer. It allows correcting more easily because</span>
260:             <span class="ruby-comment cmt"># you don't need to move your hand while hitting enter. Great</span>
261:             <span class="ruby-comment cmt"># for when eating pizza (or watching porn). It's located at:</span>
262:             <span class="ruby-comment cmt"># QWERTZ: üöä#</span>
263:             <span class="ruby-comment cmt"># QWERTY: [;'             # NEO2DE: ßdy\ </span>
264:             <span class="ruby-identifier">h</span> = <span class="ruby-identifier">event</span>.<span class="ruby-identifier">hardware_keycode</span>
265:             
266:             <span class="ruby-comment cmt"># UNDO</span>
267:             <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_z</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_BackSpace</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">undo</span> <span class="ruby-keyword kw">end</span>
268: 
269:             <span class="ruby-comment cmt"># IMAGES PREV/NEXT</span>
270:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Home</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">imagePrevNext</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">end</span>
271:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_End</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">imagePrevNext</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">end</span>
272: 
273:             <span class="ruby-comment cmt"># QUESTIONS UP/DOWN</span>
274:             <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Up</span>)   <span class="ruby-operator">||</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Page_Up</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">questionPrevNext</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">end</span>
275:             <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Down</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Page_Down</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">questionPrevNext</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">end</span>
276:             
277:             <span class="ruby-comment cmt"># ANSWERS</span>
278:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">keyval</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyval</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Left</span>  <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">==</span> <span class="ruby-value">47</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">answerPrev</span> <span class="ruby-keyword kw">end</span>
279:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">keyval</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyval</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Right</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">==</span> <span class="ruby-value">51</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">answerNext</span> <span class="ruby-keyword kw">end</span>
280: 
281:             <span class="ruby-comment cmt"># Go 5 answers down or up (especially useful for selecting tutors)</span>
282:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">keyval</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyval</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Up</span>   <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">==</span> <span class="ruby-value">34</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">answerPrev</span>(<span class="ruby-value">5</span>) <span class="ruby-keyword kw">end</span>
283:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">keyval</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Gdk</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyval</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Down</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">==</span> <span class="ruby-value">48</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">answerNext</span>(<span class="ruby-value">5</span>) <span class="ruby-keyword kw">end</span>
284: 
285:             <span class="ruby-comment cmt"># FAILED QUESTION</span>
286:             <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_3270_Enter</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_ISO_Enter</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">questionFindFail</span> <span class="ruby-keyword kw">end</span>
287:             <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_KP_Enter</span>   <span class="ruby-operator">||</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_Return</span>)   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">questionFindFail</span> <span class="ruby-keyword kw">end</span>
288: 
289:             <span class="ruby-comment cmt"># PARSE DIR AGAIN</span>
290:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_r</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">parseDirectory</span> <span class="ruby-keyword kw">end</span>
291: 
292:             <span class="ruby-comment cmt"># Export as SQL</span>
293:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_s</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">exportAsSql</span> <span class="ruby-keyword kw">end</span>
294: 
295:             <span class="ruby-comment cmt"># Mark as Failed</span>
296:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_f</span>
297:                 <span class="ruby-identifier">undoCommit</span>
298:                 <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'failchoice'</span>]
299:                 <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">true</span>
300:                 <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;Setting value to &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'failchoice'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; (marking as failed)&quot;</span>
301:                 <span class="ruby-identifier">imageUpdate</span>
302:                 <span class="ruby-identifier">answerButtonCheck</span>
303:             <span class="ruby-keyword kw">end</span>
304:             
305:             <span class="ruby-comment cmt"># QUIT</span>
306:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isCtrl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">g</span><span class="ruby-operator">::</span><span class="ruby-constant">GDK_q</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">quitApp</span> <span class="ruby-keyword kw">end</span>
307: 
308:             <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">signal_emit_stop</span>(<span class="ruby-value str">'key_press_event'</span>) 
309:         <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">initGetWorkingDirectory</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Extracts the working directory either from the command line argument or
displays a directory chooser dialog so the user can choose one. If both of
this fails the app will quit forcefully
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 73</span>
 73:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initGetWorkingDirectory</span>
 74:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Getting working directory&quot;</span>
 75:         <span class="ruby-identifier">path</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
 76:         <span class="ruby-comment cmt">#path = &quot;09ss&quot; # FIXME</span>
 77:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">path</span>)
 78: 
 79:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">path</span>)
 80:             <span class="ruby-ivar">@startUpImg</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\.tif$/</span>, <span class="ruby-value str">&quot;.yaml&quot;</span>)
 81:             <span class="ruby-ivar">@startUpQuest</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
 82:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Loading predefined file ans question:&quot;</span>
 83:             <span class="ruby-identifier">puts</span> <span class="ruby-ivar">@startUpImg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@startUpQuest</span>.<span class="ruby-identifier">to_s</span>
 84:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">path</span>)
 85:         <span class="ruby-keyword kw">end</span>        
 86: 
 87:         <span class="ruby-identifier">dialog</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">FileChooserDialog</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Select Working Directory&quot;</span>,
 88:                  <span class="ruby-keyword kw">nil</span>,
 89:                  <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">FileChooser</span><span class="ruby-operator">::</span><span class="ruby-constant">ACTION_SELECT_FOLDER</span>,
 90:                  <span class="ruby-keyword kw">nil</span>,
 91:                  [<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">CANCEL</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Dialog</span><span class="ruby-operator">::</span><span class="ruby-constant">RESPONSE_CANCEL</span>],
 92:                  [<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">OPEN</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Dialog</span><span class="ruby-operator">::</span><span class="ruby-constant">RESPONSE_ACCEPT</span>])
 93:         <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">set_window_position</span> <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Window</span><span class="ruby-operator">::</span><span class="ruby-constant">POS_CENTER</span>
 94: 
 95: 
 96:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">run</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Dialog</span><span class="ruby-operator">::</span><span class="ruby-constant">RESPONSE_ACCEPT</span>
 97:             <span class="ruby-identifier">f</span> = <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">filename</span>
 98:             <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">destroy</span>
 99:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">f</span>
100:         <span class="ruby-keyword kw">else</span>
101:             <span class="ruby-comment cmt"># Kill the app</span>
102:             <span class="ruby-identifier">dialog</span>.<span class="ruby-identifier">destroy</span>
103:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Dieing in agony because you did not specify a directory&quot;</span>
104:             <span class="ruby-constant">Process</span>.<span class="ruby-identifier">exit</span>
105:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
106:         <span class="ruby-keyword kw">end</span>
107:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">initGui</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up all elements that allow the user to interact with and dis- play
them
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initGui</span>
343:         <span class="ruby-comment cmt"># Set Window Title Defaults and so on</span>
344:         <span class="ruby-identifier">titleUpdate</span>
345:         <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;destroy&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">quitApp</span> <span class="ruby-keyword kw">end</span>
346:     
347:         <span class="ruby-comment cmt"># Center us for non-tiling WMs</span>
348:         <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">set_window_position</span> <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Window</span><span class="ruby-operator">::</span><span class="ruby-constant">POS_CENTER</span>
349:     
350:         <span class="ruby-comment cmt"># Keyboard Shortcuts</span>
351:         <span class="ruby-identifier">initAccelerators</span>
352: 
353:         <span class="ruby-comment cmt"># Setup GUI elements in order of appearance</span>
354:         <span class="ruby-identifier">toolbar</span> = <span class="ruby-identifier">initToolbar</span>
355:         
356:         <span class="ruby-ivar">@statusbar</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Statusbar</span>.<span class="ruby-identifier">new</span>
357:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">0</span>, <span class="ruby-value str">&quot;Select Answer: arrow keys  #  Find next failed-question: Enter  #  Other shortcuts: See tooltips  #  Nerd shortcuts: see source&quot;</span>
358:         
359:         <span class="ruby-ivar">@area</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">DrawingArea</span>.<span class="ruby-identifier">new</span>
360:         <span class="ruby-ivar">@area</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;expose_event&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">imageDraw</span> <span class="ruby-keyword kw">end</span>
361: 
362:         <span class="ruby-identifier">help</span> = <span class="ruby-value str">&quot;Quick Help: &quot;</span>
363:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;You can use this tool to correct questions that couldn't &quot;</span>
364:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;be determined automatically. Select what the user meant &quot;</span>
365:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;by using the ARROW KEYS and load the next question by &quot;</span>
366:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;hitting ENTER. You can undo using BACKSPACE. The &quot;</span>
367:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;selected answer is marked in green. DO NOT DECIDE FOR &quot;</span>
368:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;THE USER! If in doubt, select the left-most box to mark &quot;</span>
369:         <span class="ruby-identifier">help</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;the question as unanswered.&quot;</span>
370:         <span class="ruby-ivar">@quickHelp</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Label</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">help</span>)
371:         <span class="ruby-ivar">@quickHelp</span>.<span class="ruby-identifier">set_wrap</span> <span class="ruby-keyword kw">true</span>
372:         
373:         <span class="ruby-comment cmt"># Now lets put it all together</span>
374:         <span class="ruby-identifier">vbox</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">VBox</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">false</span>
375:         <span class="ruby-identifier">vbox</span>.<span class="ruby-identifier">pack_start</span> <span class="ruby-identifier">toolbar</span>, <span class="ruby-keyword kw">false</span>
376:         <span class="ruby-identifier">vbox</span>.<span class="ruby-identifier">pack_start</span> <span class="ruby-ivar">@area</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-value">1</span>
377:         <span class="ruby-identifier">vbox</span>.<span class="ruby-identifier">pack_start</span> <span class="ruby-ivar">@quickHelp</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-value">2</span>
378:         <span class="ruby-identifier">vbox</span>.<span class="ruby-identifier">pack_start</span> <span class="ruby-ivar">@statusbar</span>, <span class="ruby-keyword kw">false</span>
379:         <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">add</span> <span class="ruby-identifier">vbox</span>
380: 
381:         <span class="ruby-comment cmt"># All done. Let's display it.</span>
382:         <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">show_all</span>
383:         <span class="ruby-keyword kw">while</span> (<span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">events_pending?</span>)
384:             <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">main_iteration</span>
385:         <span class="ruby-keyword kw">end</span>
386: 
387:         <span class="ruby-comment cmt"># Select at least some image</span>
388:         <span class="ruby-comment cmt">#imagePrevNext(false)</span>
389:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@startUpImg</span>
390:             <span class="ruby-identifier">jumpTo</span>(<span class="ruby-ivar">@startUpImg</span>, <span class="ruby-ivar">@startUpQuest</span>)
391:             <span class="ruby-ivar">@startUpImg</span> = <span class="ruby-keyword kw">nil</span>
392:         <span class="ruby-keyword kw">else</span>
393:             <span class="ruby-identifier">questionFindFail</span>(<span class="ruby-keyword kw">false</span>)
394:         <span class="ruby-keyword kw">end</span>
395:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">initToolbar</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Contains definitions for all the toolbar buttons and sets them up
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 155</span>
155:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initToolbar</span>
156:         <span class="ruby-comment cmt"># Setup all the buttons</span>
157:         <span class="ruby-ivar">@undo</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">UNDO</span>)
158:         <span class="ruby-ivar">@undo</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Undo the Last Change and Review Question (BACKSPACE) (CTRL + Z)&quot;</span>
159:         <span class="ruby-ivar">@undo</span>.<span class="ruby-identifier">set_sensitive</span> <span class="ruby-keyword kw">false</span>
160:         <span class="ruby-ivar">@undo</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">undo</span> <span class="ruby-keyword kw">end</span>
161: 
162:         <span class="ruby-ivar">@img_prev</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">GO_BACK</span>)
163:         <span class="ruby-ivar">@img_prev</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Prev. Sheet&quot;</span>
164:         <span class="ruby-ivar">@img_prev</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Load Previous Sheet (HOME)&quot;</span>
165:         <span class="ruby-ivar">@img_prev</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">imagePrevNext</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">end</span>
166:         
167:         <span class="ruby-ivar">@img_next</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">GO_FORWARD</span>)
168:         <span class="ruby-ivar">@img_next</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Next Sheet&quot;</span>
169:         <span class="ruby-ivar">@img_next</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Load Next Image (END)&quot;</span>
170:         <span class="ruby-ivar">@img_next</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">imagePrevNext</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">end</span>
171: 
172:         <span class="ruby-ivar">@quest_prev</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">GOTO_TOP</span>)
173:         <span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Prev. Question&quot;</span>
174:         <span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;View the Previous Question (CTRL + UP ARROW) (PAGE UP)&quot;</span>
175:         <span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">questionPrevNext</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">end</span>
176:         <span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
177: 
178:         <span class="ruby-ivar">@quest_next</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">GOTO_BOTTOM</span>)
179:         <span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Next Question&quot;</span>
180:         <span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;View the Next Question (CTRL + DOWN ARROW) (PAGE DOWN)&quot;</span>
181:         <span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">questionPrevNext</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">end</span>
182:         <span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
183:         
184:         <span class="ruby-ivar">@answr_prev</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">GOTO_FIRST</span>)
185:         <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Prev. Answer&quot;</span>
186:         <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Select the Previous/Lefthand Answer (LEFT/UP ARROW)&quot;</span>
187:         <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">answerPrev</span> <span class="ruby-keyword kw">end</span>
188:         <span class="ruby-ivar">@answr_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
189:         
190:         <span class="ruby-ivar">@answr_next</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">GOTO_LAST</span>)
191:         <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Next Answer&quot;</span>
192:         <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Select the Next/Righthand Answer (RIGHT/DOWN ARROW)&quot;</span>
193:         <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">answerNext</span> <span class="ruby-keyword kw">end</span>
194:         <span class="ruby-ivar">@answr_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
195:         
196:         <span class="ruby-ivar">@find_fail</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">FIND</span>)
197:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Find Failed Question&quot;</span>
198:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Finds an Improperly Answered Question (ENTER)&quot;</span>
199:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">questionFindFail</span> <span class="ruby-keyword kw">end</span>
200: 
201:         <span class="ruby-identifier">parse_again</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">REFRESH</span>)
202:         <span class="ruby-identifier">parse_again</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Find New Files&quot;</span>
203:         <span class="ruby-identifier">parse_again</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Parse Working Directory Again for New Files (CTRL + R)&quot;</span>
204:         <span class="ruby-identifier">parse_again</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">parseDirectory</span> <span class="ruby-keyword kw">end</span>
205:         
206:         <span class="ruby-identifier">sql</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">SAVE_AS</span>)
207:         <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">set_label</span> <span class="ruby-value str">&quot;Export as SQL&quot;</span>
208:         <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Export the current datasheet as SQL file (CTRL + S)&quot;</span>
209:         <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">exportAsSql</span> <span class="ruby-keyword kw">end</span>
210:         
211:         <span class="ruby-identifier">quit</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolButton</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Stock</span><span class="ruby-operator">::</span><span class="ruby-constant">QUIT</span>)
212:         <span class="ruby-identifier">quit</span>.<span class="ruby-identifier">set_tooltip_text</span> <span class="ruby-value str">&quot;Exits the Application (CTRL + Q)&quot;</span>
213:         <span class="ruby-identifier">quit</span>.<span class="ruby-identifier">signal_connect</span> <span class="ruby-value str">&quot;clicked&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">quitApp</span> <span class="ruby-keyword kw">end</span>
214: 
215:         <span class="ruby-ivar">@prog</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ProgressBar</span>.<span class="ruby-identifier">new</span>
216:         <span class="ruby-ivar">@prog</span>.<span class="ruby-identifier">text</span> = <span class="ruby-value str">&quot;If this moves, you stop!&quot;</span>
217:         <span class="ruby-ivar">@prog</span>.<span class="ruby-identifier">set_pulse_step</span>(<span class="ruby-value">0</span><span class="ruby-value">.025</span>)
218:         <span class="ruby-identifier">pulse</span>
219:         
220:         <span class="ruby-comment cmt"># Setup actual toolbar</span>
221:         <span class="ruby-identifier">toolbar</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Toolbar</span>.<span class="ruby-identifier">new</span>  
222:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">set_toolbar_style</span> <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">Toolbar</span><span class="ruby-operator">::</span><span class="ruby-constant">Style</span><span class="ruby-operator">::</span><span class="ruby-constant">BOTH</span>
223:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">0</span>, <span class="ruby-ivar">@undo</span>
224:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">1</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">SeparatorToolItem</span>.<span class="ruby-identifier">new</span>
225:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">2</span>, <span class="ruby-ivar">@img_prev</span>
226:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">3</span>, <span class="ruby-ivar">@img_next</span>
227:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">4</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">SeparatorToolItem</span>.<span class="ruby-identifier">new</span>
228:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">5</span>, <span class="ruby-ivar">@quest_prev</span>
229:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">6</span>, <span class="ruby-ivar">@quest_next</span>
230:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">7</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">SeparatorToolItem</span>.<span class="ruby-identifier">new</span>
231:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">8</span>, <span class="ruby-ivar">@answr_prev</span>
232:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span>  <span class="ruby-value">9</span>, <span class="ruby-ivar">@answr_next</span>
233:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">10</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">SeparatorToolItem</span>.<span class="ruby-identifier">new</span>
234:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">11</span>, <span class="ruby-ivar">@find_fail</span>
235:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">12</span>, <span class="ruby-identifier">parse_again</span>
236:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">13</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">SeparatorToolItem</span>.<span class="ruby-identifier">new</span>
237:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">14</span>, <span class="ruby-identifier">sql</span>
238:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">15</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">SeparatorToolItem</span>.<span class="ruby-identifier">new</span>
239:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">16</span>, <span class="ruby-identifier">quit</span>
240: 
241:         <span class="ruby-identifier">space</span> = <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolItem</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">add</span>((<span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">VBox</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-value">2</span>))
242:         <span class="ruby-identifier">space</span>.<span class="ruby-identifier">set_expand</span>(<span class="ruby-keyword kw">true</span>)
243:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">17</span>, <span class="ruby-identifier">space</span>
244:         
245:         <span class="ruby-identifier">toolbar</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">18</span>, <span class="ruby-constant">Gtk</span><span class="ruby-operator">::</span><span class="ruby-constant">ToolItem</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">add</span>(<span class="ruby-ivar">@prog</span>)
246: 
247:         <span class="ruby-identifier">toolbar</span>
248:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">jumpTo</span><span class="method-args">(image, question, answer = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Jumps to given image and question and optionally sets the question&#8216;s
value to the given answer.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 399</span>
399:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">jumpTo</span>(<span class="ruby-identifier">image</span>, <span class="ruby-identifier">question</span>, <span class="ruby-identifier">answer</span> = <span class="ruby-keyword kw">nil</span>)
400:         <span class="ruby-identifier">undoEnd</span>
401:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Jumping to: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">image</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; / &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">question</span>
402:         <span class="ruby-identifier">writeYAML</span>
403:         <span class="ruby-ivar">@currentImage</span> = <span class="ruby-identifier">image</span>
404:         <span class="ruby-ivar">@currentQuestion</span> = <span class="ruby-identifier">question</span>
405:         <span class="ruby-identifier">sheetLoad</span>
406: 
407:         <span class="ruby-comment cmt"># Find correct group</span>
408:         <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>].<span class="ruby-identifier">allChildren</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
409:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">g</span>[<span class="ruby-value str">'dbfield'</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@currentQuestion</span>
410:             <span class="ruby-ivar">@group</span> = <span class="ruby-identifier">g</span>
411:             <span class="ruby-keyword kw">break</span>
412:         <span class="ruby-keyword kw">end</span>
413: 
414:         <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>] = <span class="ruby-identifier">answer</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">answer</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
415:         <span class="ruby-comment cmt">#sheetLoad</span>
416:         <span class="ruby-identifier">findPageForQuestion</span>
417:         <span class="ruby-identifier">questionButtonCheck</span>
418:         <span class="ruby-identifier">answerButtonCheck</span>
419:         <span class="ruby-identifier">imageButtonCheck</span>
420:         <span class="ruby-identifier">imageUpdate</span>
421:         <span class="ruby-identifier">titleUpdate</span>
422:         <span class="ruby-identifier">undoStart</span>
423:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">parseDirectory</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Looks for YAML files in the working directory (@dir) and adds them to the
list. It will only add files which aren&#8216;t indexed already
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parseDirectory</span>
117:         <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
118:         <span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;Parsing Directory... &quot;</span>
119:         <span class="ruby-identifier">newfiles</span> = <span class="ruby-keyword kw">false</span>
120:         <span class="ruby-comment cmt"># We can certainly skip the check on first load</span>
121:         <span class="ruby-identifier">skipCheck</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">empty?</span>
122:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-ivar">@dir</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/*.yaml&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
123:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">zero?</span>(<span class="ruby-identifier">file</span>)
124:             <span class="ruby-comment cmt"># Only add not already parsed files</span>
125:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">skipCheck</span>; <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fileAlreadyParsed?</span>(<span class="ruby-identifier">file</span>); <span class="ruby-keyword kw">end</span>
126:             <span class="ruby-comment cmt"># Arguments: filename, has been checked for errors</span>
127:             <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">file</span>, <span class="ruby-keyword kw">false</span>]
128:             <span class="ruby-identifier">newfiles</span> = <span class="ruby-keyword kw">true</span>
129:         <span class="ruby-keyword kw">end</span>
130: 
131:         <span class="ruby-comment cmt"># Translate yaml path into index id</span>
132:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@startUpImg</span>
133:             <span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;Found &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@startUpImg</span>
134:             <span class="ruby-ivar">@startUpImg</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">index</span>([<span class="ruby-ivar">@startUpImg</span>, <span class="ruby-keyword kw">false</span>])
135:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot; @ &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@startUpImg</span>.<span class="ruby-identifier">to_s</span>
136:         <span class="ruby-keyword kw">end</span>
137:         
138:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;found new files! :D&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">newfiles</span>
139:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;but found nothing new :(&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">newfiles</span>
140: 
141:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot; (took: &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span><span class="ruby-operator">-</span><span class="ruby-identifier">start_time</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; s)&quot;</span>
142:         <span class="ruby-identifier">titleUpdate</span>
143:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@find_fail</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">newfiles</span>
144:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">processEvents</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Small helper function that avoids stalling the GUI when doing work
intensive stuff on the main thread
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 720</span>
720:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">processEvents</span>
721:         <span class="ruby-keyword kw">while</span> (<span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">events_pending?</span>)
722:             <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">main_iteration</span>
723:         <span class="ruby-keyword kw">end</span>
724:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">pulse</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Pluse the progress bar and process events so the change is visible to the
user. Note that this will kick off any Gtk.add_idle pro- cesses.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 729</span>
729:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pulse</span>
730:         <span class="ruby-ivar">@prog</span>.<span class="ruby-identifier">pulse</span>
731:         <span class="ruby-identifier">processEvents</span>
732:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">questionButtonCheck</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks if the question buttons need to be en/disabled and does so
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 471</span>
471:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">questionButtonCheck</span>
472:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@doc</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@currentQuestion</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@group</span>
473:             <span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
474:             <span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
475:             <span class="ruby-keyword kw">return</span>
476:         <span class="ruby-keyword kw">end</span>
477:         <span class="ruby-identifier">groups</span> = <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>].<span class="ruby-identifier">allChildren</span>
478:         <span class="ruby-identifier">i</span> = <span class="ruby-identifier">groups</span>.<span class="ruby-identifier">index</span>(<span class="ruby-ivar">@group</span>)
479:         
480:         <span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">groups</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)
481:         <span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
482: 
483:         <span class="ruby-identifier">titleUpdate</span>
484:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">questionFindFail</span><span class="method-args">(reparseDirectory = true, isPreload = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Looks at all loaded @files and searches them for failed choices. Selects
the first failed question it finds. Pass true to look for <a
href="PESTFix.html#M000006">new</a> files in the working directory if all
loaded files are depleted
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 651</span>
651:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">questionFindFail</span>(<span class="ruby-identifier">reparseDirectory</span> = <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">isPreload</span> = <span class="ruby-keyword kw">false</span>)
652:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">sensitive?</span>
653:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">99</span>, <span class="ruby-value str">&quot;### PLEASE WAIT ### LOOKING FOR FAILED QUESTION ###&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">isPreload</span>
654:         <span class="ruby-ivar">@cancelFindFail</span> = <span class="ruby-keyword kw">false</span>
655:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Looking for wrongly answered question&quot;</span>
656:         <span class="ruby-comment cmt"># Deactivate while searching</span>
657:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
658:         <span class="ruby-identifier">undoEnd</span>
659: 
660:         <span class="ruby-identifier">writeYAML</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">isPreload</span>
661: 
662:         <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>            
663:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">isPreload</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@imgpath</span> <span class="ruby-operator">==</span><span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>])
664:             <span class="ruby-identifier">isPreload</span> <span class="ruby-value">? </span><span class="ruby-identifier">processEvents</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">pulse</span>
665:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@cancelFindFail</span>
666:                 <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">pop</span> <span class="ruby-value">99</span>
667:                 <span class="ruby-keyword kw">return</span>
668:             <span class="ruby-keyword kw">end</span>
669:             <span class="ruby-identifier">doc</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>]))
670:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">doc</span>
671:                 <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;WARNING: yaml file cannot be read or is broken: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>]
672:                 <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Skipping to next file&quot;</span>
673:                 <span class="ruby-keyword kw">next</span>
674:             <span class="ruby-keyword kw">end</span>
675:             <span class="ruby-identifier">doc</span>[<span class="ruby-value str">'page'</span>].<span class="ruby-identifier">allChildren</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
676:                 <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">g</span>[<span class="ruby-value str">'value'</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">g</span>[<span class="ruby-value str">'failchoice'</span>]
677:                 <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">g</span>[<span class="ruby-value str">'failchoice'</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
678:                 <span class="ruby-identifier">curImg</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">f</span>)
679:                 <span class="ruby-identifier">curQue</span> = <span class="ruby-identifier">g</span>[<span class="ruby-value str">'dbfield'</span>]
680:                 <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">true</span>)
681:                 <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">isPreload</span>
682:                     <span class="ruby-identifier">jumpTo</span>(<span class="ruby-identifier">curImg</span>, <span class="ruby-identifier">curQue</span>)
683:                     <span class="ruby-identifier">questionFindFailPreload</span>
684:                 <span class="ruby-keyword kw">end</span>
685:                 <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">pop</span> <span class="ruby-value">99</span>                    
686:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">curImg</span>
687:             <span class="ruby-keyword kw">end</span>
688:             <span class="ruby-identifier">f</span>[<span class="ruby-value">1</span>] = <span class="ruby-keyword kw">true</span>
689:         <span class="ruby-keyword kw">end</span>
690:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">pop</span> <span class="ruby-value">99</span>        
691: 
692:         <span class="ruby-comment cmt"># This is basically a convenient function that automatically looks</span>
693:         <span class="ruby-comment cmt"># for new YAML files. Makes correcting while still parsing much</span>
694:         <span class="ruby-comment cmt"># easier</span>
695:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reparseDirectory</span>
696:             <span class="ruby-identifier">parseDirectory</span>
697:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">questionFindFail</span>(<span class="ruby-keyword kw">false</span>)
698:         <span class="ruby-keyword kw">end</span>
699:         
700:         <span class="ruby-comment cmt"># ok, all files seem to have passed</span>
701:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">false</span>)
702:         <span class="ruby-identifier">undoStart</span>
703:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">2</span>, <span class="ruby-value str">&quot;No more failed questions found! (You may want to reload the directory for changes though)&quot;</span>
704:         <span class="ruby-comment cmt"># Load at least some image if none has been displayed so far</span>
705:         <span class="ruby-identifier">imagePrevNext</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@doc</span>
706:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
707:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">questionFindFailPreload</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds the next failed question without jumping to it, instead pre- loads
this image
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 711</span>
711:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">questionFindFailPreload</span>        
712:         <span class="ruby-ivar">@gtkThreadFindFail</span> = <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">idle_add</span> <span class="ruby-keyword kw">do</span>
713:             <span class="ruby-ivar">@preloadMePlease</span> = <span class="ruby-identifier">questionFindFail</span>(<span class="ruby-keyword kw">false</span>, <span class="ruby-keyword kw">true</span>)
714:             <span class="ruby-identifier">sheetPreload</span>
715:         <span class="ruby-keyword kw">end</span>
716:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">questionFirst</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads the first question of the current sheet and en/disbales the
quest_next/prev buttons accordingly
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 638</span>
638:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">questionFirst</span>
639:         <span class="ruby-identifier">undoEnd</span>
640:         <span class="ruby-ivar">@currentPage</span> = <span class="ruby-value">0</span>
641:         <span class="ruby-ivar">@group</span> =  <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>][<span class="ruby-value">0</span>][<span class="ruby-value">1</span>] <span class="ruby-comment cmt"># Selects first group</span>
642:         <span class="ruby-ivar">@currentQuestion</span> = <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'dbfield'</span>]
643:         <span class="ruby-identifier">questionButtonCheck</span>
644:         <span class="ruby-identifier">answerButtonCheck</span>
645:         <span class="ruby-identifier">undoStart</span>
646:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">questionPrevNext</span><span class="method-args">(isPrev)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds the previous question for the current one, works across pages and
en/disables quest_next/prev buttons accordingly
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 603</span>
603:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">questionPrevNext</span>(<span class="ruby-identifier">isPrev</span>)
604:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@quest_next</span>.<span class="ruby-identifier">sensitive?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">isPrev</span>
605:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@quest_prev</span>.<span class="ruby-identifier">sensitive?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">isPrev</span>
606:         <span class="ruby-comment cmt"># Save undo before loading</span>
607:         <span class="ruby-identifier">undoEnd</span>
608: 
609:         <span class="ruby-comment cmt"># FIXME</span>
610:         <span class="ruby-identifier">a</span> = <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>].<span class="ruby-identifier">allChildren</span>
611:         <span class="ruby-identifier">a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
612:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>[<span class="ruby-value str">'dbfield'</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@currentQuestion</span>
613:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">isPrev</span>
614:                 <span class="ruby-identifier">new</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">previous</span>(<span class="ruby-identifier">e</span>)
615:             <span class="ruby-keyword kw">else</span>
616:                 <span class="ruby-identifier">new</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">next</span>(<span class="ruby-identifier">e</span>)
617:             <span class="ruby-keyword kw">end</span>
618:             
619:             <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new</span>
620:             <span class="ruby-ivar">@currentQuestion</span> = <span class="ruby-identifier">new</span>[<span class="ruby-value str">'dbfield'</span>]
621:             <span class="ruby-ivar">@group</span> = <span class="ruby-identifier">new</span>
622:             <span class="ruby-keyword kw">break</span>
623:         <span class="ruby-keyword kw">end</span>
624:         <span class="ruby-identifier">findPageForQuestion</span>
625:         <span class="ruby-identifier">questionButtonCheck</span>
626:         <span class="ruby-identifier">answerButtonCheck</span>
627:         <span class="ruby-identifier">imageUpdate</span>
628:         <span class="ruby-identifier">undoStart</span>
629:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <a href="#M000040" class="method-signature">
          <span class="method-name">quitApp</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Saves the changed YAML and quits the app gracefully
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000040-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000040-source">
<pre>
      <span class="ruby-comment cmt"># File fix.rb, line 1024</span>
1024:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quitApp</span>
1025:         <span class="ruby-identifier">writeYAML</span>
1026:         <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">timeout_remove</span>(<span class="ruby-ivar">@gtkParseDirThread</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@gtkParseDirThread</span>
1027:         <span class="ruby-identifier">stopFindFail</span>
1028:         <span class="ruby-ivar">@yamlSaveThread</span>.<span class="ruby-identifier">join</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@yamlSaveThread</span>
1029:         <span class="ruby-comment cmt"># This may assert in case there's a background thread running,</span>
1030:         <span class="ruby-comment cmt"># but for now I don't care</span>
1031:         <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">main_quit</span>
1032:         <span class="ruby-comment cmt">#begin Process.exit; rescue; end</span>
1033:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000036" class="method-detail">
        <a name="M000036"></a>

        <div class="method-heading">
          <a href="#M000036" class="method-signature">
          <span class="method-name">sheetLoad</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads an image and its YAML file from disk. This only needs to be called
everytime the image changes (i.e. not for question and answer changes).
(followup: <a href="PESTFix.html#M000038">imageUpdate</a>)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000036-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000036-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 801</span>
801:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sheetLoad</span>
802:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;=&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-value">20</span>
803:         <span class="ruby-comment cmt"># No change, so don't bother</span>
804:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@currentDisplayedImage</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@currentImage</span>
805:         <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
806:         
807:         <span class="ruby-ivar">@currentDisplayedImage</span> = <span class="ruby-ivar">@currentImage</span>
808:         <span class="ruby-identifier">f</span> = <span class="ruby-ivar">@files</span>[<span class="ruby-ivar">@currentImage</span>]
809:         <span class="ruby-ivar">@imgpath</span> = <span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>]
810: 
811:         <span class="ruby-comment cmt"># Check for preload</span>
812:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@preloadID</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@preloadIsDone</span>
813:             <span class="ruby-comment cmt"># We don't need to destroy @orig here since it is swapped</span>
814:             <span class="ruby-comment cmt"># with @preloadImage which gets destroyed later on</span>
815:             <span class="ruby-ivar">@orig</span>, <span class="ruby-ivar">@preloadImage</span> = <span class="ruby-ivar">@preloadImage</span>, <span class="ruby-ivar">@orig</span>
816:             <span class="ruby-ivar">@doc</span> = <span class="ruby-ivar">@preloadDoc</span>
817:             <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">false</span>
818:             <span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;Pre-&quot;</span>
819:         <span class="ruby-keyword kw">else</span>
820:             <span class="ruby-ivar">@orig</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">destroy!</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@orig</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
821:             <span class="ruby-comment cmt"># Load new IMG            </span>
822:             <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>])
823:             <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>], <span class="ruby-value str">&quot;.yaml&quot;</span>)
824:             <span class="ruby-identifier">img</span> = <span class="ruby-identifier">dir</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tif&quot;</span>
825: 
826:             <span class="ruby-ivar">@doc</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>]))
827:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@doc</span>
828:                 <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;ERROR: yaml file cannot be read or is broken: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>]
829:             <span class="ruby-keyword kw">end</span>
830:             <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">false</span>
831:             
832:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">img</span>)
833:                 <span class="ruby-ivar">@orig</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageList</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">img</span>)
834:             <span class="ruby-keyword kw">else</span>
835:                 <span class="ruby-comment cmt"># This is a small tweak that at least doesn't crash the</span>
836:                 <span class="ruby-comment cmt"># application. It provides no info for the user what</span>
837:                 <span class="ruby-comment cmt"># went wrong, but that shouldn't happen.</span>
838:                 <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;ERROR: Image File not found: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">img</span>
839:                 <span class="ruby-ivar">@orig</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageList</span>.<span class="ruby-identifier">new</span>
840:                 <span class="ruby-ivar">@doc</span>[<span class="ruby-value str">'page'</span>].<span class="ruby-identifier">size</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
841:                     <span class="ruby-ivar">@orig</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2480</span>, <span class="ruby-value">3507</span>) {
842:                         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">background_color</span> = <span class="ruby-value str">'grey'</span>
843:                     }
844:                 <span class="ruby-keyword kw">end</span>
845:             <span class="ruby-keyword kw">end</span>
846:             
847:             
848:         <span class="ruby-keyword kw">end</span>
849: 
850:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Loading IMG+YAML &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; (took: &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span><span class="ruby-operator">-</span><span class="ruby-identifier">start_time</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; s)&quot;</span>
851:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000037" class="method-detail">
        <a name="M000037"></a>

        <div class="method-heading">
          <a href="#M000037" class="method-signature">
          <span class="method-name">sheetPreload</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads the sheet given by @preloadMePlease into memory if possible The
function is executed on the same thread as the caller, so avoid calling it
when doing other processing. Try the following: <tt>Gtk.idle_add { <a
href="PESTFix.html#M000037">sheetPreload</a> }</tt>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000037-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000037-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 857</span>
857:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sheetPreload</span>
858:         <span class="ruby-comment cmt"># Don't preload the current or preloaded sheet</span>
859:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@preloadMePlease</span>  <span class="ruby-operator">||</span> <span class="ruby-ivar">@preloadID</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@preloadMePlease</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@preloadMePlease</span>
860: 
861:         <span class="ruby-comment cmt"># Mark the cache as invalid</span>
862:         <span class="ruby-ivar">@preloadIsDone</span> = <span class="ruby-keyword kw">false</span>
863:         
864:         <span class="ruby-comment cmt"># Don't preload non-existing sheets</span>
865:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@preloadMePlease</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@preloadMePlease</span> <span class="ruby-operator">&gt;</span> (<span class="ruby-ivar">@files</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)
866: 
867:         <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
868:         <span class="ruby-ivar">@preloadID</span> = <span class="ruby-ivar">@preloadMePlease</span>         
869:         <span class="ruby-identifier">f</span> = <span class="ruby-ivar">@files</span>[<span class="ruby-ivar">@preloadMePlease</span>]
870: 
871:         <span class="ruby-ivar">@preloadImage</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">destroy!</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@preloadImage</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
872:         
873:         <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>])
874:         <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>], <span class="ruby-value str">&quot;.yaml&quot;</span>)
875:         <span class="ruby-identifier">img</span> = <span class="ruby-identifier">dir</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tif&quot;</span>
876:         
877:         <span class="ruby-ivar">@preloadImage</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageList</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">img</span>)
878:         <span class="ruby-ivar">@preloadDoc</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>]))
879:         
880:         <span class="ruby-ivar">@preloadIsDone</span> = <span class="ruby-keyword kw">true</span>
881:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Preloading: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; (took: &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span><span class="ruby-operator">-</span><span class="ruby-identifier">start_time</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; s)&quot;</span>        
882:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <a href="#M000032" class="method-signature">
          <span class="method-name">stopFindFail</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Stops the find fail thread that may run in the background (i.e. the user
selected another image while searching)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000032-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000032-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 736</span>
736:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stopFindFail</span>
737:         <span class="ruby-constant">Gtk</span>.<span class="ruby-identifier">idle_remove</span>(<span class="ruby-ivar">@gtkThreadFindFail</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@gtkThreadFindFail</span>
738:         <span class="ruby-ivar">@cancelFindFail</span> = <span class="ruby-keyword kw">true</span>
739:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">true</span>)
740:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">titleUpdate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Updates the window title
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 147</span>
147:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">titleUpdate</span>
148:         <span class="ruby-identifier">title</span> = <span class="ruby-value str">&quot;PEST: Fix &quot;</span>
149:         <span class="ruby-identifier">count</span> = <span class="ruby-value str">&quot;[&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@currentImage</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; / &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">size</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;] &quot;</span>
150:         <span class="ruby-identifier">quest</span> = <span class="ruby-value str">&quot;(Q: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@currentQuestion</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;) &quot;</span>
151:         <span class="ruby-ivar">@window</span>.<span class="ruby-identifier">set_title</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">quest</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;    &quot;</span><span class="ruby-operator">+</span> <span class="ruby-ivar">@imgpath</span>
152:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">undo</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Undoes the last change made
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 426</span>
426:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">undo</span>
427:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">empty?</span>
428:         <span class="ruby-identifier">undo</span> = <span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">pop</span>
429:         <span class="ruby-ivar">@undo</span>.<span class="ruby-identifier">set_sensitive</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">empty?</span>
430:         <span class="ruby-comment cmt"># Reset the checked state so findFailed finds this again</span>
431:         <span class="ruby-ivar">@files</span>[<span class="ruby-identifier">undo</span>[<span class="ruby-value">0</span>]][<span class="ruby-value">1</span>] = <span class="ruby-keyword kw">false</span>
432:         <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">true</span>      
433:         <span class="ruby-identifier">jumpTo</span>(<span class="ruby-identifier">undo</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">undo</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">undo</span>[<span class="ruby-value">2</span>])
434:         <span class="ruby-ivar">@find_fail</span>.<span class="ruby-identifier">set_sensitive</span>(<span class="ruby-keyword kw">true</span>)
435:         <span class="ruby-ivar">@statusbar</span>.<span class="ruby-identifier">push</span> <span class="ruby-value">4</span>, <span class="ruby-value str">&quot;Undid last change&quot;</span>
436:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">undoCommit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This puts the data into the real <a
href="PESTFix.html#M000016">undo</a>-stack so that it may be un- done. The
data needs to be gathered with <a href="PESTFix.html#M000017">undoStart</a>
beforehand
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 449</span>
449:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">undoCommit</span>
450:         <span class="ruby-ivar">@undoActions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@undoStartState</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@undoStartState</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
451:         <span class="ruby-ivar">@undoStartState</span> = <span class="ruby-keyword kw">nil</span>
452:         <span class="ruby-ivar">@undo</span>.<span class="ruby-identifier">set_sensitive</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">empty?</span>
453:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">undoEnd</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This checks if the latest entry in the <a
href="PESTFix.html#M000016">undo</a> buffer it actually worth saving and
removes it if not. E.g. if the user changes an answer and manually corrects
it afterwards, no real change has been carried out and therefore may be
removed.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 459</span>
459:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">undoEnd</span>
460:         <span class="ruby-keyword kw">return</span> <span class="ruby-comment cmt"># Deactivated for now</span>
461:         <span class="ruby-identifier">a</span> = <span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">last</span>
462:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@currentImage</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@currentQuestion</span>
463:         <span class="ruby-comment cmt"># The value changed, so keep it in the undo list</span>
464:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>]
465:         <span class="ruby-comment cmt"># else remove it</span>
466:         <span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">pop</span>
467:         <span class="ruby-ivar">@undo</span>.<span class="ruby-identifier">set_sensitive</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">empty?</span>
468:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">undoStart</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This should be called whenever a <a href="PESTFix.html#M000006">new</a>
question is displayed. It saves the given values into a temporary variable
so they may be retrieved if the user chooses to change the answer
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 441</span>
441:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">undoStart</span>
442:         <span class="ruby-comment cmt">#puts &quot;Saving current values into temp undo buffer&quot;</span>
443:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@group</span>
444:         <span class="ruby-ivar">@undoStartState</span> = [<span class="ruby-ivar">@currentImage</span>, <span class="ruby-ivar">@currentQuestion</span>, <span class="ruby-ivar">@group</span>[<span class="ruby-value str">'value'</span>]]
445:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="#M000035" class="method-signature">
          <span class="method-name">writeYAML</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes the changes to the YAML file if required. It uses the <a
href="PESTFix.html#M000016">undo</a> buffer to determine if the current
YAML document has changed
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000035-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000035-source">
<pre>
     <span class="ruby-comment cmt"># File fix.rb, line 783</span>
783:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">writeYAML</span>
784:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@yamlChanged</span>
785:         <span class="ruby-identifier">a</span> = <span class="ruby-ivar">@undoActions</span>.<span class="ruby-identifier">last</span>
786:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@currentImage</span>
787:         <span class="ruby-identifier">s</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
788:         <span class="ruby-comment cmt"># Do this in a background thread, it goes from 0.10s to 0.20s</span>
789:         <span class="ruby-comment cmt"># down to ~0.01s</span>
790:         <span class="ruby-ivar">@yamlSaveThread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
791:             <span class="ruby-identifier">fout</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@files</span>[<span class="ruby-ivar">@currentImage</span>][<span class="ruby-value">0</span>], <span class="ruby-value str">&quot;w&quot;</span>)
792:             <span class="ruby-identifier">fout</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">dump</span>(<span class="ruby-ivar">@doc</span>)
793:             <span class="ruby-identifier">fout</span>.<span class="ruby-identifier">close</span>
794:         <span class="ruby-keyword kw">end</span>
795:         <span class="ruby-ivar">@yamlChanged</span> = <span class="ruby-keyword kw">false</span>
796:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>