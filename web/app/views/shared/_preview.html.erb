<%
# this is a general preview shared view. Hand in the text that should
# be previewed as a local variable, like this:
# <%= render :partial => "shared/preview", :locals => { :text => TEXT } %>
%>

<% cache("#{params[:controller]}_#{params[:id]}") do %>
  <% failed, exitcodes, error, base64 = texpreview(text) %>

  <% if failed || base64.nil? %>
    <strong>Error:</strong> An error occurred while rendering the preview. Most likely, you have a typo in the TeX code somewhere. Scroll down to see what TeX has to say about this.<br/><br/>
    EXIT CODES: <%= exitcodes.join(", ") %> <br/> <%= error %>
  <% end %>

  <%= "<img src=\"data:image/png;base64,#{base64}\"/>" unless failed || base64.nil? || base64.empty? %>
<% end %>
