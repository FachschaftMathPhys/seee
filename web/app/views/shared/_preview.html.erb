<%
  # this is a general preview shared view. The actual preview function
  # below has to be defined in the _helper file. Add symbolic links to
  # this file in each views/(model)/, so that Rails know where to look
  # for this function.
%>

<% cache("#{params[:controller]}_#{params[:id]}") do %>
  <% failed, exitcodes, error, base64 = render_preview %>

  <% if failed || base64.nil? %>
    <strong>Error:</strong> An error occurred while rendering the preview. Most likely, you have a typo in the TeX code somewhere. Scroll down to see what TeX has to say about this.<br/><br/>
    EXIT CODES: <%= exitcodes.join(", ") %> <br/> <%= error %>
  <% end %>

  <%= "<img src=\"data:image/png;base64,#{base64}\"/>" unless failed || base64.nil? || base64.empty? %>
<% end %>
