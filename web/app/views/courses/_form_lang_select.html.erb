<script type="text/javascript">
  var sfl = <%= json_map_sfl %>;

  function updateSelectors() {
    // gather data derivable from "term"
    // $("#course_form_id > option:selected").text()
    var availForms = sfl[$("#course_term_id").val()].forms;

    // find current settings of "form"
    var formOldName = $("#course_form_id > option:selected").text();

    // rebuild forms drop down
    var cfi = $("#course_form_id");
    cfi.html("");
    $.each(availForms, function (fid, data) {
      cfi.append($("<option />").val(fid).text(data.name).attr("selected", formOldName == data.name));
    });

    // gather data derivable from "form"
    var langs = availForms[$("#course_form_id").val()].langs;

    // find current settings of "lang"
    var langOld = $("#course_language > option:selected").text();

    // rebuild langs drop down
    var cl = $("#course_language");
    cl.html("");
    $.each(langs, function (index, lang) {
      cl.append($("<option />").val(lang).text(lang).attr("selected", langOld == lang));
    });
  }

  $(document).ready(function() {
    updateSelectors();
  });
</script>
