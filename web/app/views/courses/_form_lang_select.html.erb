<script type="text/javascript">
  var sfl = <%= json_map_sfl %>;

  function updateSelectors() {
    // gather data derivable from "semester"
    var semSelect = document.getElementById("course_semester_id");
    var semId = semSelect.options[semSelect.selectedIndex].value;
    var sem = sfl[semId];
    var availForms = sem["forms"];

    // find current settings of "form"
    var formSelect = document.getElementById("course_form_id");
    var formOldId = formSelect.options[formSelect.selectedIndex].value;

    // rebuild forms drop down
    formSelect.options.length = 0
    for(var fid in availForms) {
      var i = formSelect.options.length;
      var name = availForms[fid]["name"];
      formSelect.options[i]=new Option(name, fid, fid == formOldId);
    }

    // gather data derivable from "form"
    var formId = formSelect.options[formSelect.selectedIndex].value;
    var form = availForms[formId];
    var availLangs = form["langs"];

    // find current settings of "lang"
    var langSelect = document.getElementById("course_language");
    var langOld = langSelect.options[langSelect.selectedIndex].value;

    // rebuild langs drop down
    langSelect.options.length = 0
    for(var lid in availLangs) {
      var i = langSelect.options.length;
      var l = availLangs[lid];
      langSelect.options[i]=new Option(l, l, l == langOld);
    }
  }

  window.onload=updateSelectors;
</script>
