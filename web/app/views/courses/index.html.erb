<% curSem = Semester.find(:all).find{|s| s.now? } %>

<h1>Listing courses of <%=h curSem.title %></h1>
<% if curSem.critical? %>
<h2 style="color:red;background:white">Careful now, the semester is critical. No unwary changes.</h2>
<% end %>
<p>
  <%= link_to 'Prof List', :controller => "profs", :action => "index" %> |
  <%= link_to 'Semester List', :controller => "semesters", :action => "index" %> |
  <%= link_to 'New course', new_course_path %>
</p>

<table>
  <tr>
    <!--<th>Semester</th>-->
    <% ["Title", "Students", "Evaluated by", "Profs", "Description", "Faculty"].each do |x| %>
    <th <%= sort_class(x) %>>
        <%= sort_link(x) %>
    </th>
    <% end %>
  </tr>

<%
courses = sort_helper(@courses.find_all{|c| c.semester.now? })

for course in courses %>
  <tr style="background: #<%= cycle('efefef', 'fff') %>">
    <td><%= link_to course.title, course %></td>
    <td style="color: <%= course.students == 999 ? "red" : "black" %>"><%=h course.students %></td>
    <td><%=h course.evaluator %></td>
    <td><%=h course.profs.collect { |p| p.fullname }.join(", ") %></td>
    <td><%=h course.description %></td>
    <td><%=h course.faculty.shortname %></td>
  </tr>
<% end %>
</table>

<br />
<%= link_to 'New course', new_course_path %> |
<%= link_to 'New Prof', new_prof_path %> |
<%= link_to 'New semester', new_semester_path %>

