<%= render "shared/main_menu" %>

<% content_for :script, javascript_include_tag("table_filter") %>

<fieldset>
  <h1>Listing courses of <%=h @curr_sem.map { |c| c.title }.join(", ") %></h1>

  <div style="float:left">
    <%= link_to 'New course', new_course_path %>
  </div>

  <div style="float:right;margin-left:1em;">
<% if params[:search] %>
    <%= link_to 'Show all', courses_path %>
<% else %>
    <%= link_to 'Show all', courses_path, :onclick => "table_filter_clear('search', 'courses_table'); return false;" %>
<% end %>
  </div>

  <% form_tag courses_path, :method => 'get', :style=>"float:right" do %>
    <%= text_field_tag :search, params[:search],
        :placeholder => "Filterâ€¦", :type => "search",
        :onkeyup => params[:search] ? "" : "table_filter(this.value, 'courses_table')" %>
    <%= submit_tag "Filter", :name => nil %>
  <% end %>
</fieldset>

<!-- didn't put the table in a fieldset because the horizontal space is too valuable -->
<table style="margin-top:1em;" id="courses_table">
  <tr>
    <% ["Title", "Students", "Evaluated by", "Profs", "Description", "Faculty"].each do |x| %>
    <th <%= sort_class(x) %>>
        <%= sort_link(x) %>
    </th>
    <% end %>
  </tr>

<%
courses = sort_helper(@courses)

for course in courses %>
  <tr class="<%= cycle('odd', 'even') %>">
    <td><%= link_to course.title, course %></td>
    <td style="color: <%= course.students == 999 ? "red" : "black" %>"><%=h course.students %></td>
    <td><%=h course.evaluator %></td>
    <td><%=h course.profs.collect { |p| p.fullname }.join(", ") %></td>
    <td><%=h course.description %></td>
    <td><%=h course.faculty.shortname %></td>
  </tr>
<% end %>
</table>

<fieldset>
  <p>
    <%= link_to 'New course', new_course_path %> |
    <%= link_to 'New Prof', new_prof_path %> |
    <%= link_to 'New semester', new_semester_path %>
  </p>
</fieldset>
