% Only prints the results in horizontal bars. One line for each result.
% Answers are printed to the left of the bars. Expects the data to be
% available in the following format:
% lines = [{ :count => 1234, :name => "Name of answer" }, …]
% addlines = […]
% Options include:
% options = { :skip_empty => true, :sort_by => :name | :count }
% Sorting only applies to lines, addlines are printed in order at the
% end of the graph.

<%
case options[:sort_by]
  when :count:
    lines.sort! { |x,y| y[:count] <=> x[:count] }
  when :name:
    lines.sort! { |x,y| x[:name] <=> y[:name] }
end

lines << addlines
%>


\setlength{\unitlength}{1mm}
\noindent%
\begin{picture}(85,<%= 6+lines.size*6 %>)
  \put(0, <%=lines.size*6%>){\makebox(38, 6)[r]{\textbf{<%=title%>}}}

<%
  all = 0.0
  lines.each { |l| all += l[:count].to_f }
%>

<% lines.reverse.each_with_index do |line, i| %>
  <% next if options[:skip_empty] && line[:count] == 0 %>
  \put(0, <%= i*6 %>){\makebox(38, 6)[r]{<%=line[:name]%>}}
  \put(40, <%= i*6 %>){\framebox(\thebarwidth, 5){}}
% need to adjust the 5/2 factor if the horizontal width of the bar is
% changed. happy experimenting! (tip: 100% == \thebarwidth)
  \put(40, <%= i*6 %>){\rule{<%=(line[:count]/all*100*0.35).to_i%>mm}{5mm}}
  \put(72, <%= i*6 %>){\makebox(10, 6)[r]{<%=line[:count]%>}}

<% end %>
\end{picture}
